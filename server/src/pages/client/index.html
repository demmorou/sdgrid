<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta http-equiv="Content-Language" content="pt-br">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="/socket.io/socket.io.js"></script>
    <title>SD-Grid - Cliente</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">SD-Grid</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>
    <div class="container mt-3">
        <form id="campoenvio">
            <div class="jumbotron">
                <h2>Corretor de palavras</h2>
                <select id="tipo" class="form-control">
                    <option selected value="selecione">Selecione</option>
                    <option value="texto">Texto</option>
                    <option value="arquivo">Arquivo</option>
                </select>
                <div id="divinput">
                    <div id="divtexto" class="input-group mt-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Texto</span>
                        </div>
                        <textarea id="texto" class="form-control" aria-label="With textarea"></textarea>
                    </div>
                    <div id="divfile" class="form-group mt-3">
                        <input type="file" class="form-control-file" id="customFileLang" lang="pt-br">
                        <span class="badge badge-success mt-3" id="sizefile"></span>
                    </div>
                    <button id="btnSend" type="submit" class="mt-4 btn btn-primary">Enviar</button>
                </div>
            </div>
        </form>
        <div class="alert-info" id="words">
        </div>
    </div>
    
    <script src=”teste.js”></script>
    <script type="text/javascript">
        var socket = io.connect();

        $('#divinput').hide();

        $('#customFileLang').bind('change', function() {
        var fSExt = new Array('Bytes', 'KB', 'MB', 'GB');
        fSize = this.files[0].size; 
        i=0;
        while(fSize>900){
            fSize/=1024;
            i++;
        }
        $("#sizefile").text((Math.round(fSize*100)/100)+' '+fSExt[i]);
        });

        $("#tipo").change(function() {
            if($(this).val() == 'texto'){
                $('#divinput').show();
                $("#divtexto").show();
                $("#divfile").hide();
            }else if ($(this).val() == 'arquivo') {
                $('#divinput').show();
                $("#divfile").show();
                $("#divtexto").hide();
            }else{
                $("#divfile").hide();
                $("#divtexto").hide();
                $('#divinput').hide();
            }
        });

        $("form#campoenvio").submit(function(e) {
            e.preventDefault();
            console.log($("#tipo").val()=="texto")
            if ($("#tipo").val()=="texto") {
                var message = $("#texto").val()
            } else {
                var message = $("#customFileLang").val()
            }
            var dados = { messageType: $("#tipo").val(), message: message}
            console.log(dados)
            socket.emit("dadosCliente", dados);
        });

        socket.on("correcao", function (palavras) {
                console.log(palavras);
                jQuery.each(palavras, function (i, val) {
                    $("#" + i).append(document.createTextNode(" - " + val));
                    $("#words").append(`
                    <div class="p-3 mb-2 bg-info text-white">
                        Palavra: ${i}<br>
                        Sugestões: ${val}<br>
                    </div>`)
                });
            });
    </script>
</body>

</html>